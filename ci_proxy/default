# nginx configuration

server {
    listen 443 ssl;

    ssl_certificate /etc/letsencrypt/live/staging.urbanstats.lukebrody.com/fullchain.pem; # managed by Certbot
    ssl_certificate_key /etc/letsencrypt/live/staging.urbanstats.lukebrody.com/privkey.pem; # managed by Certbot
    include /etc/letsencrypt/options-ssl-nginx.conf; # managed by Certbot
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem; # managed by Certbot

    location / {
        set $branch "";
        if ($host ~* "^([^.]+)\.staging\.urbanstats\.lukebrody\.com$") {
            set $branch $1;
        }
        if ($branch = "") {
            return 404;
        }
        root /root/urbanstats/ci_proxy/densitydb/repos/$branch;
        try_files $uri $uri/ =404;
    }
}
