import assert from 'assert/strict'
import { describe, it } from 'node:test'

import { stringIndexToLocation } from '../src/urban-stats-script/editor-utils.ts.disabled'

void describe('stringIndexToLocation', () => {
    const cases = [
        {
            desc: 'line 0, column 0 for index 0',
            text: 'hello\nworld',
            index: 0,
            expected: { lineIdx: 0, colIdx: 0 },
        },
        {
            desc: 'correct location for index in first line',
            text: 'hello\nworld',
            index: 3,
            expected: { lineIdx: 0, colIdx: 3 },
        },
        {
            desc: 'correct location for last index in first line',
            text: 'hello\nworld',
            index: 5,
            expected: { lineIdx: 0, colIdx: 5 },
        },
        {
            desc: 'correct location for index at start of second line',
            text: 'hello\nworld',
            index: 6,
            expected: { lineIdx: 1, colIdx: 0 },
        },
        {
            desc: 'correct location for index in second line',
            text: 'hello\nworld',
            index: 8,
            expected: { lineIdx: 1, colIdx: 2 },
        },
        {
            desc: 'handle empty string',
            text: '',
            index: 0,
            expected: { lineIdx: 0, colIdx: 0 },
        },
        {
            desc: 'handle index at end of string',
            text: 'a\nb\nc',
            index: 'a\nb\nc'.length,
            expected: { lineIdx: 2, colIdx: 1 },
        },
        {
            desc: 'handle multiple consecutive newlines',
            text: 'a\n\n\nb',
            index: 3,
            expected: { lineIdx: 2, colIdx: 0 },
        },
        {
            desc: 'handle index out of bounds',
            text: 'abc',
            index: 100,
            expected: { lineIdx: 0, colIdx: 100 },
        },
    ]

    cases.forEach(({ desc, text, index, expected }) => {
        void it(`should ${desc}`, () => {
            const lines = text.split('\n')
            const result = stringIndexToLocation(lines, index)
            assert.deepEqual(result, expected)
        })
    })
})
